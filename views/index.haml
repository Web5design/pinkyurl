%form{:action => '/i', :method => 'get'}
  %h6 <span class="pink">pinky</span>url
  %h1 snapshot any website
  %p
    %label{:for => 'url'} url
    %input{:name => 'url', :id => 'url', :type => 'text', :value => @example}
    %input{:type => 'submit', :value => 'create'}
    %a{:href => '#', :class => 'options'} options
  %p.minor{:style => 'display: none;'}
    %label{:for => 'out-format'} format
    %select{:name => 'out-format', :id => 'out-format'}
      - %w/ bmp gif html itext jpeg mng pdf png ppm ps rtree svg tiff xbm xpm /.each do |f|
        %option{:selected => (f == 'png')}= f
    %label{:for => 'resize'} resize
    %input{:name => 'resize', :id => 'resize', :value => 640, :type => 'text'}
    %label{:for => 'crop'} crop
    %input{:name => 'crop', :id => 'crop', :type => 'text'}
    %label{:for => 'expire'} expire
    %input{:name => 'expire', :id => 'expire', :type => 'checkbox', :value => 1}
  #info{:style => 'display: none;'}
    %hr/
    %label{:for => 'embed'} embed
    %textarea{:id => 'embed'}
:javascript
  $(document).ready(function() {
    var loading = $('<img src="/images/loading.gif" />')
      .css('opacity', 0)
      .addClass('loading');

    $('a.options').click(function() {
      $('.minor').toggle('fast');
      return false;
    });

    $('#info textarea').focus(function() {
      $(this).select();
    });

    $('form :input:visible:first').select();

    $('form').submit(function() {
      var almostReady = false;
      var displayThumbnail = function() {
        if (!almostReady) {
          almostReady = true;
        } else {
          var f = $('form'),
              top = f.offset().top + f.outerHeight() + parseInt(f.css('marginBottom'));
          loading.fadeOut('normal', function() {
            img
              .hide()
              .appendTo(document.body)
              .wrap($('<a>').attr('href', img.attr('src')))
              .fadeIn('fast');
          });
        }
      };

      var url = $(this).attr('action') + '?' + $(this).serialize();
      var img = $('<img>')
        .load(displayThumbnail)
        .addClass('thumbnail')
        .attr('src', url);

      $('img.thumbnail').fadeOut();
      $('h1')
        .fadeTo('normal', 0)
        .slideUp(function() {
          $('#info')
            .find('textarea')
              .text(window.location + url.replace('/', ''))
              .end()
            .fadeIn()
            .find('textarea')
              .select();
          loading
            .appendTo(document.body)
            .show()
            .fadeTo('slow', 1,
              displayThumbnail);
        });

      return false;
    });
  });
